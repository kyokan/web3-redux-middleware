{"version":3,"sources":["../src/index.js"],"names":["web3Middleware","config","PROMIEVENT_TYPE_SUFFIXES","promiEventTypeSuffixes","defaultTypes","PROMIEVENT_TYPE_DELIMITER","promiEventTypeDelimiter","store","dispatch","next","action","promiEventOrPromise","data","isRegularPromise","payload","PAYLOAD","promiEvent","promise","TYPE","type","META","meta","createAction","newPayload","event","join","error","undefined","onFulfilled","result","onRejected","err","onTransactionHash","hash","onReceipt","receipt","onError","confirmationsCount","onConfirmation","confirmationNumber","reciept","then","catch","on"],"mappings":"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","file":"index.js","sourcesContent":["import { isPromiEvent } from './isPromiEvent'\nimport { isPromise } from './isPromise'\nimport { defaultTypes } from './constants'\n\nexport default function web3Middleware(config = {}) {\n  const PROMIEVENT_TYPE_SUFFIXES = config.promiEventTypeSuffixes || defaultTypes;\n  const PROMIEVENT_TYPE_DELIMITER = config.promiEventTypeDelimiter || '_';\n\n  return store => {\n    const { dispatch } = store;\n\n    return next => action => {\n      let promiEventOrPromise;\n      let data;\n      let isRegularPromise;\n\n      if (!action.payload) {\n        return next(action);\n      }\n\n      const PAYLOAD = action.payload;\n\n      /*\n       * 3 cases\n       * 1. action.payload is a promiEvent or promise\n       * 2. action.payload.promiEvent or action.payload.promise is\n       * 3. neither is and we should just call next\n       */\n\n      if (isPromiEvent(PAYLOAD) || isPromise(PAYLOAD)) {\n        promiEventOrPromise = PAYLOAD;\n        isRegularPromise = !isPromiEvent(PAYLOAD)\n\n      } else if (\n        isPromiEvent(PAYLOAD.promiEvent) ||\n        isPromise(PAYLOAD.promiEvent) ||\n        isPromiEvent(PAYLOAD.promise) ||\n        isPromise(PAYLOAD.promise)\n      ) {\n        promiEventOrPromise = PAYLOAD.promiEvent || PAYLOAD.promise;\n        data = PAYLOAD.data;\n        isRegularPromise = !isPromiEvent(promiEventOrPromise) && isPromise(promiEventOrPromise)\n\n      } else {\n        return next(action)\n      }\n\n      const TYPE = action.type;\n      const META = action.meta;\n\n      const createAction = (newPayload, event) => {\n        const type = [\n          TYPE,\n          PROMIEVENT_TYPE_SUFFIXES[event]\n        ].join(PROMIEVENT_TYPE_DELIMITER);\n\n        const payload = newPayload === null || typeof newPayload === 'undefined'\n          ? {}\n          : {payload: newPayload};\n\n        const error = event === 'error' || event === 'rejected' ? {error: true} : {};\n\n        const meta = META !== undefined ? {meta: META} : {}\n\n        return ({\n          type,\n          ...payload,\n          ...error,\n          ...meta,\n        })\n      }\n\n      const onFulfilled = result => dispatch(createAction(result, 'fulfilled'));\n      const onRejected = err => dispatch(createAction(err, 'rejected'))\n      const onTransactionHash = hash => dispatch(createAction(hash, 'transactionHash'));\n      const onReceipt = receipt => dispatch(createAction(receipt, 'reciept'));\n      const onError = err => dispatch(createAction(err, 'error'))\n\n      let confirmationsCount = 0;\n      const onConfirmation = (confirmationNumber, reciept) => {\n        confirmationsCount += 1;\n\n        return dispatch(createAction({\n          confirmationNumber,\n          reciept,\n          confirmationsCount\n        }, 'confirmation'));\n      };\n\n      dispatch(createAction(data, 'pending'));\n\n      if (isRegularPromise) {\n        return promiEventOrPromise.then(onFulfilled).catch(onRejected)\n      }\n      return promiEventOrPromise\n        .on('transactionHash', onTransactionHash)\n        .on('confirmation', onConfirmation)\n        .on('receipt', onReceipt)\n        .on('error', onError)\n        .then(onFulfilled)\n        .catch(onRejected);\n    }\n  }\n}"]}